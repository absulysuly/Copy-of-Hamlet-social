(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[354],{12018:function(e,t,n){Promise.resolve().then(n.bind(n,36629))},36629:function(e,t,n){"use strict";n.d(t,{default:function(){return p}});var r=n(57437),a=n(2265),o=n(954),i=n(34446),s=n(21513),l=e=>{let{title:t,subtitle:n}=e;return(0,r.jsxs)(s.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-iraq-red via-iraq-white to-iraq-green p-8 rounded-2xl text-center my-6",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-2 font-arabic",style:{textShadow:"1px 1px 2px rgba(0,0,0,0.1)"},children:t}),(0,r.jsx)("p",{className:"text-gray-700",children:n})]})},c=n(53977),d=n(59333),u=n(20357);async function g(e,t,n,r){let a=new Int16Array(e.buffer),o=a.length/r,i=t.createBuffer(r,o,n);for(let e=0;e<r;e++){let t=i.getChannelData(e);for(let n=0;n<o;n++)t[n]=a[n*r+e]/32768}return i}function p(e){let{dictionary:t}=e,[n,p]=(0,a.useState)("disconnected"),[f,m]=(0,a.useState)([]),[h,x]=(0,a.useState)(!1),v=(0,a.useRef)(null),y=(0,a.useRef)(null),b=(0,a.useRef)(null),w=(0,a.useRef)(null),j=(0,a.useRef)(null),k=(0,a.useRef)(new Set).current,N=0;(0,a.useEffect)(()=>{u.env.API_KEY||(console.error("Gemini API key is missing. The Tea House feature is disabled."),x(!0),p("error"))},[]),(0,a.useEffect)(()=>{j.current&&(j.current.scrollTop=j.current.scrollHeight)},[f]);let C=(0,a.useCallback)(()=>{v.current&&(v.current.then(e=>e.close()),v.current=null),y.current&&(y.current.getTracks().forEach(e=>e.stop()),y.current=null),w.current&&(w.current.disconnect(),w.current=null),b.current&&"closed"!==b.current.state&&b.current.close(),k.forEach(e=>e.stop()),k.clear(),p("disconnected")},[k]),A=async()=>{if(!h&&!v.current){p("connecting");try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert("Your browser does not support audio recording."),p("error");return}y.current=await navigator.mediaDevices.getUserMedia({audio:!0});let e=new o.fA({apiKey:u.env.API_KEY}),t=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3});b.current=t;let n=new(window.AudioContext||window.webkitAudioContext)({sampleRate:24e3});v.current=e.live.connect({model:"gemini-2.5-flash-native-audio-preview-09-2025",config:{responseModalities:[o.mM.AUDIO],inputAudioTranscription:{},outputAudioTranscription:{},systemInstruction:"You are a friendly and knowledgeable host at a digital Iraqi tea house (Diwan). Your goal is to foster positive and engaging conversations about civic life, community, and the future. Keep your responses concise, warm, and encouraging. Your name is Naseem."},callbacks:{onopen:()=>{p("connected");let e=t.createMediaStreamSource(y.current),n=t.createScriptProcessor(4096,1,1);w.current=n,n.onaudioprocess=e=>{var t;let n=e.inputBuffer.getChannelData(0),r=function(e){let t=e.length,n=new Int16Array(t);for(let r=0;r<t;r++)n[r]=32768*e[r];return{data:function(e){let t="",n=e.byteLength;for(let r=0;r<n;r++)t+=String.fromCharCode(e[r]);return btoa(t)}(new Uint8Array(n.buffer)),mimeType:"audio/pcm;rate=16000"}}(n);null===(t=v.current)||void 0===t||t.then(e=>{e.sendRealtimeInput({media:r})})},e.connect(n),n.connect(t.destination)},onmessage:async e=>{var t,r,a,o,i,s,l;if(null===(t=e.serverContent)||void 0===t?void 0:t.inputTranscription){let{text:t}=e.serverContent.inputTranscription;t&&m(e=>{let n=e[e.length-1];return n&&"user"===n.author&&!n.isFinal?[...e.slice(0,-1),{...n,text:n.text+t}]:[...e,{id:Date.now(),text:t,author:"user",isFinal:!1}]})}if(null===(r=e.serverContent)||void 0===r?void 0:r.outputTranscription){let{text:t}=e.serverContent.outputTranscription;t&&m(e=>{let n=e[e.length-1];return n&&"model"===n.author&&!n.isFinal?[...e.slice(0,-1),{...n,text:n.text+t}]:[...e,{id:Date.now(),text:t,author:"model",isFinal:!1}]})}if((null===(a=e.serverContent)||void 0===a?void 0:a.turnComplete)&&m(e=>e.map(e=>e.isFinal?e:{...e,isFinal:!0})),(null===(i=e.serverContent)||void 0===i?void 0:null===(o=i.modelTurn)||void 0===o?void 0:o.parts)&&(null===(l=e.serverContent.modelTurn.parts[0])||void 0===l?void 0:null===(s=l.inlineData)||void 0===s?void 0:s.data)){let t=e.serverContent.modelTurn.parts[0].inlineData.data;N=Math.max(N,n.currentTime);let r=await g(function(e){let t=atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return r}(t),n,24e3,1),a=n.createBufferSource();a.buffer=r,a.connect(n.destination),a.addEventListener("ended",()=>k.delete(a)),a.start(N),N+=r.duration,k.add(a)}},onerror:e=>{console.error("Session error:",e),p("error"),C()},onclose:e=>{C()}}})}catch(e){console.error("Failed to start session:",e),p("error"),C()}}};(0,a.useEffect)(()=>()=>{C()},[C]);let T="connected"===n||"connecting"===n,E={disconnected:{text:t.page.teahouse.disconnected,color:"bg-gray-500"},connecting:{text:t.page.teahouse.connecting,color:"bg-yellow-500 animate-pulse"},connected:{text:t.page.teahouse.connected,color:"bg-green-500"},error:{text:h?"Service Unavailable":t.page.teahouse.error,color:"bg-red-500"}};return(0,r.jsxs)("div",{className:"container mx-auto max-w-3xl px-4 py-8",children:[(0,r.jsx)(l,{title:t.page.teahouse.title,subtitle:t.page.teahouse.description}),(0,r.jsxs)("div",{className:"relative overflow-hidden rounded-2xl bg-white p-6 shadow-xl dark:bg-gray-800",children:[(0,r.jsx)("div",{className:"absolute inset-0 -z-0 bg-gradient-to-br from-gray-50 via-white to-gray-100 dark:from-gray-900/50 dark:via-gray-800 dark:to-gray-900/30"}),(0,r.jsxs)("div",{className:"relative z-10",children:[(0,r.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"h-3 w-3 rounded-full ".concat(E[n].color)}),(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:E[n].text})]}),"connected"===n&&(0,r.jsx)("p",{className:"animate-pulse text-sm text-green-600 dark:text-green-400",children:t.page.teahouse.speakNow})]}),(0,r.jsx)("div",{ref:j,className:"scrollbar-hide mb-6 h-80 space-y-4 overflow-y-auto rounded-lg bg-gray-50 p-4 dark:bg-gray-900/50",children:(0,r.jsx)(i.M,{children:f.map(e=>(0,r.jsx)(s.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},layout:!0,className:"flex ".concat("user"===e.author?"justify-end":"justify-start"),children:(0,r.jsx)("div",{className:"max-w-xs rounded-2xl px-4 py-2 md:max-w-md ".concat("user"===e.author?"rounded-br-none bg-green-100 dark:bg-green-900/50":"rounded-bl-none bg-gray-200 dark:bg-gray-700"),children:(0,r.jsx)("p",{className:"text-gray-800 dark:text-gray-200 ".concat(e.isFinal?"":"opacity-70"),children:e.text})})},e.id))})}),(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsxs)(s.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:T?C:A,className:"flex items-center gap-3 rounded-full px-8 py-4 font-bold text-white transition-all disabled:cursor-not-allowed disabled:bg-gray-400 disabled:shadow-none ".concat(T?"bg-red-600 hover:bg-red-700 shadow-[0_0_20px_theme(colors.red.400)]":"bg-green-600 hover:bg-green-700 shadow-lg"),animate:T?{scale:[1,1.05,1]}:{},transition:T?{repeat:1/0,duration:2,ease:"easeInOut"}:{},disabled:"connecting"===n||h,children:[T?(0,r.jsx)(c.Z,{}):(0,r.jsx)(d.Z,{}),(0,r.jsx)("span",{children:T?t.page.teahouse.leave:t.page.teahouse.join})]})})]})]})]})}}},function(e){e.O(0,[19,513,234,971,582,744],function(){return e(e.s=12018)}),_N_E=e.O()}]);