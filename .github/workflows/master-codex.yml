name: 🚀 Hamlet Unified – Full Auto Pipeline
on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  phase1_setup:
    name: Phase 1 – Railway Deployment
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Verify Prisma schema exists
        run: |
          if [ ! -f prisma/schema.prisma ]; then
            echo "❌ Prisma schema not found! Add prisma/schema.prisma before deploying."
            exit 1
          else
            echo "✅ Prisma schema found – continuing..."
          fi

      - run: npm ci
      - run: npx prisma generate && npx prisma db push
      - run: bash ./deploy-railway.sh
      - run: bash ./health-check.sh
